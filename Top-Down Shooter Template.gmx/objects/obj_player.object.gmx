<!--This Document is generated by GameMaker, if you edit it by hand then you do so at your own risk!-->
<object>
  <spriteName>spr_player</spriteName>
  <solid>0</solid>
  <visible>-1</visible>
  <depth>0</depth>
  <persistent>0</persistent>
  <parentName>&lt;undefined&gt;</parentName>
  <maskName>spr_mask_32</maskName>
  <events>
    <event eventtype="0" enumb="0">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>/// Initlialisation of the player object

xspeed = 0;
yspeed = 0;
fric = 0.5

dir = 0;

hp = 100;

max_load = 30;
ammo_loaded = max_load;
ammo_left = 300;

reloading = false;
firetimer = 0;
firemax = 4;
offset_ang = 0.5;


key_up = ord("W");
key_down = ord("S");
key_left = ord("A");
key_right = ord("D");


</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="2" enumb="0">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>/// RELOADING!
reloading = false;

</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="3" enumb="0">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>/// Controls

var _accel = 1;
var _maxspeed = 4;
var _ud = keyboard_check(key_down)-keyboard_check(key_up);
var _lr = keyboard_check(key_right)-keyboard_check(key_left);



/// Movement

dir = point_direction(x,y,mouse_x,mouse_y);
yspeed += _ud*_accel;
xspeed += _lr*_accel;

xspeed = clamp(xspeed-fric*sign(xspeed),-_maxspeed,_maxspeed);
yspeed = clamp(yspeed-fric*sign(yspeed),-_maxspeed,_maxspeed);

if (abs(xspeed) &lt; 0.2) {
    xspeed = 0;
}
if (abs(yspeed) &lt; 0.2) {
    yspeed = 0;
}

// floored speed values (for accurate collision checking)
var _fxspeed = floor(xspeed);
var _fyspeed = floor(yspeed);

var _tx = (x+_fxspeed);
var _ty = (y+_fyspeed);

if (place_meeting(x+_fxspeed,y,obj_wall) ) {
    _tx = x;
}
if (place_meeting(x,y+_fyspeed,obj_wall) ) {
    _ty = y;
}



///Shooting

if (mouse_check_button(mb_left) &amp;&amp; !reloading) {
    if (ammo_loaded &gt; 0  &amp;&amp; (firetimer == 0) ) {
        ammo_loaded--;
        with (instance_create(x,y,obj_player_bullet)) {
            var _ang =  + random_range(-other.offset_ang,other.offset_ang);
            xspeed = lengthdir_x(spd,other.dir + _ang);
            yspeed = lengthdir_y(spd,other.dir + _ang);
        }
    }
    firetimer = (firetimer+1) mod firemax;
}

if ((ammo_loaded &lt;= 0 || keyboard_check_pressed(ord("R")))) {
        var _diff = max_load - ammo_loaded;    
        var _pull;
        if (_diff &lt; ammo_left) {
            _pull = _diff;
        } else {
            _pull = ammo_left;
        }
        ammo_left -= _pull;
        ammo_loaded += _pull;
        reloading = true;
    alarm[0] = room_speed*0.5;
}

// Animated bits

if (reloading) {
    sprite_index = spr_player_reload;
} else {
    sprite_index = spr_player;
}

// Non-wall collisions
var _inst;
_inst = instance_place(x,y,obj_ammo);
if (_inst != noone) {
    instance_destroy(_inst);
    ammo_left += 30;
}
_inst = instance_place(x,y,obj_enemy_bullet);
if (_inst != noone) {
    hp -= 5;
    instance_destroy(_inst);
}


// Finalise movement
if (hp &gt; 0) {    // if you're not dead
    x = _tx;
    y = _ty;
} else {
    show_message("You died after senselessly killing " + string(obj_controller.killed_enemies) + " soldiers");
    game_restart();
}

</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="8" enumb="64">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>/// GUI
draw_text(4,48,"Ammo: " + string(ammo_loaded) + "/" + string(ammo_left));
draw_text(4,64,"HP: " + string(hp));

</string>
          </argument>
        </arguments>
      </action>
    </event>
    <event eventtype="8" enumb="0">
      <action>
        <libid>1</libid>
        <id>603</id>
        <kind>7</kind>
        <userelative>0</userelative>
        <isquestion>0</isquestion>
        <useapplyto>-1</useapplyto>
        <exetype>2</exetype>
        <functionname></functionname>
        <codestring></codestring>
        <whoName>self</whoName>
        <relative>0</relative>
        <isnot>0</isnot>
        <arguments>
          <argument>
            <kind>1</kind>
            <string>/// @description Draw player
draw_sprite_ext(sprite_index,image_index,x,y,1,1,dir,c_white,1);
var _str = "x: " + string(x) + "\n" + "y: " + string(y);
draw_text(x-16,y+32,_str);

</string>
          </argument>
        </arguments>
      </action>
    </event>
  </events>
  <PhysicsObject>0</PhysicsObject>
  <PhysicsObjectSensor>0</PhysicsObjectSensor>
  <PhysicsObjectShape>0</PhysicsObjectShape>
  <PhysicsObjectDensity>0.5</PhysicsObjectDensity>
  <PhysicsObjectRestitution>0.100000001490116</PhysicsObjectRestitution>
  <PhysicsObjectGroup>0</PhysicsObjectGroup>
  <PhysicsObjectLinearDamping>0.100000001490116</PhysicsObjectLinearDamping>
  <PhysicsObjectAngularDamping>0.100000001490116</PhysicsObjectAngularDamping>
  <PhysicsObjectFriction>0.200000002980232</PhysicsObjectFriction>
  <PhysicsObjectAwake>-1</PhysicsObjectAwake>
  <PhysicsObjectKinematic>0</PhysicsObjectKinematic>
  <PhysicsShapePoints/>
</object>
